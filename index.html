<!doctype html>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1">
<title>Love Note</title>
<style>
  :root{ --pink:#ff6fbf; --bg:#0b0d10; }
  html,body{height:100%;margin:0}
  body{
    background:var(--bg); color:var(--pink);
    display:flex; align-items:center; justify-content:center;
    flex-direction:column; text-align:center;
    font-family:system-ui,-apple-system,Segoe UI,Roboto,Arial,sans-serif;
    overflow:hidden; padding:6vh 6vw;
  }

  /* Typing container */
  .txt{
    font-size: clamp(18px, 4.5vw, 36px);
    line-height: 1.35;
    text-shadow: 0 0 .4em rgba(255,111,191,.55);
    max-width: 900px;
  }

  /* New letter-by-letter pop style */
  .ch{
    opacity: 0;
    display: inline-block;
    transform: translateY(.15em) scale(.98);
    animation: pop .24s ease-out forwards;
  }
  @keyframes pop{
    60%{ opacity: 1; transform: translateY(-.04em) scale(1.04); }
    100%{ opacity: 1; transform: translateY(0) scale(1); }
  }

  /* Blinking caret */
  .caret{
    display:inline-block; width:.55ch; height:1em; vertical-align:-0.1em;
    border-right: .12em solid currentColor; margin-left:.06ch;
    animation: blink .9s step-end infinite;
  }
  @keyframes blink{50%{border-right-color:transparent}}

  /* Floating hearts/sparkles */
  .float{position:fixed; inset:0; pointer-events:none;}
  .float span{
    position:absolute; bottom:-10vh; font-size:24px; opacity:.9;
    animation:rise linear forwards;
    filter:drop-shadow(0 0 6px rgba(255,111,191,.6));
  }
  @keyframes rise{
    0%{transform:translateY(0) translateX(0) rotate(0deg); opacity:0;}
    10%{opacity:1;}
    100%{transform:translateY(-120vh) translateX(var(--drift,0)) rotate(360deg); opacity:0;}
  }

  /* Music pill */
  .pill{
    position:fixed; right:12px; bottom:12px;
    background:rgba(255,111,191,.15);
    border:1px solid rgba(255,111,191,.35);
    color:var(--pink); padding:.6rem .9rem; border-radius:999px;
    backdrop-filter:saturate(140%) blur(6px);
    font-weight:600; cursor:pointer; box-shadow:0 6px 18px rgba(0,0,0,.25);
  }
  .pill:hover{background:rgba(255,111,191,.25)}
  .hidden{display:none}
</style>

<div class="txt" id="out" aria-live="polite"></div>
<div class="caret" id="caret"></div>

<div class="float" id="fx"></div>
<button id="music" class="pill hidden">Tap for music ♪</button>

<script>
/* ========= 1) YOUR MESSAGE ========= */
const MESSAGE = `Hola bby ❤️

I just wanted you to know
how much I love you.

Every little thing you do makes my day brighter,
and even when we're apart, you're always on my mind.

You mean so much to me,
and I’m so grateful to have you.

Love u always 💖

With all my heart,
M`;

/* === Typing settings === */
const TYPING_SPEED_MS = 36;     // time between letters
const PARAGRAPH_PAUSE_MS = 350; // extra pause after each line break
const POP_RANDOM_JITTER = 90;   // small randomness to timing (ms)

/* ========= 2) LETTER-BY-LETTER TYPING ========= */
const out = document.getElementById('out');
const caret = document.getElementById('caret');
let i = 0;

function appendChar(ch){
  if(ch === '\n'){
    out.appendChild(document.createElement('br'));
    return;
  }
  const span = document.createElement('span');
  span.className = 'ch';
  // ✅ Fix: ensure spaces render correctly
  span.textContent = (ch === ' ') ? '\u00A0' : ch;

  // small random delay for natural pop
  span.style.animationDelay = (Math.random()*POP_RANDOM_JITTER/1000).toFixed(3) + 's';
  out.appendChild(span);
}

function typeNext(){
  if(i >= MESSAGE.length){
    // caret can stay for vibe
    return;
  }
  const ch = MESSAGE[i++];
  appendChar(ch);
  const delay = (ch === '\n') ? PARAGRAPH_PAUSE_MS : TYPING_SPEED_MS;
  setTimeout(typeNext, delay);
}
setTimeout(typeNext, 500);

/* ========= 3) FLOATING HEARTS ========= */
(function(){
  const fx = document.getElementById('fx');
  const SYMS = ['💖','✨','💗','💞'];
  function spawn(){
    const s = document.createElement('span');
    s.textContent = SYMS[Math.floor(Math.random()*SYMS.length)];
    s.style.left = (Math.random()*100) + 'vw';
    s.style.fontSize = (18 + Math.random()*26) + 'px';
    s.style.setProperty('--drift', (Math.random()*80 - 40) + 'px');
    s.style.animationDuration = (5 + Math.random()*5) + 's';
    fx.appendChild(s);
    s.addEventListener('animationend', ()=> s.remove());
  }
  for(let k=0;k<18;k++) setTimeout(spawn, k*120); // burst
  setInterval(spawn, 400);                        // stream
})();

/* ========= 4) SOFT INSTRUMENTAL BACKGROUND ========= */
(function(){
  let ctx, master, on = false, timer;
  const btn = document.getElementById('music');
  const chords = [
    [261.63, 329.63, 392.00, 493.88], // Cmaj7
    [220.00, 261.63, 329.63, 440.00], // Am7
    [174.61, 220.00, 261.63, 349.23], // Fmaj7
    [196.00, 246.94, 392.00, 493.88]  // G-ish
  ];

  function playChord(chord){
    const now = ctx.currentTime;
    chord.forEach((f)=>{
      const o = ctx.createOscillator();
      const g = ctx.createGain();
      o.type = 'sine'; o.frequency.value = f; o.detune.value = (-6 + Math.random()*12);
      g.gain.setValueAtTime(0.0, now);
      g.gain.linearRampToValueAtTime(0.04/chord.length, now + 1.5);
      g.gain.linearRampToValueAtTime(0.0, now + 6.0);
      o.connect(g); g.connect(master);
      o.start(now); o.stop(now + 6.2);
    });
  }

  async function startAudio(){
    if(on) return;
    ctx = ctx || new (window.AudioContext || window.webkitAudioContext)();
    master = master || ctx.createGain();
    master.gain.value = 0.0001;
    master.connect(ctx.destination);
    try{ await ctx.resume(); }catch(e){}
    master.gain.exponentialRampToValueAtTime(0.05, ctx.currentTime + 3);
    let i = 0;
    function tick(){ playChord(chords[i++ % chords.length]); }
    tick();
    timer = setInterval(tick, 6000);
    on = true;
  }

  function stopAudio(){
    if(!on) return;
    clearInterval(timer);
    if(master) master.gain.exponentialRampToValueAtTime(0.0001, ctx.currentTime + 1);
    on = false;
  }

  document.addEventListener('DOMContentLoaded', async ()=>{
    try{
      await startAudio();
      if(!ctx || ctx.state !== 'running') btn.classList.remove('hidden');
    }catch(e){ btn.classList.remove('hidden'); }
  });

  document.getElementById('music').addEventListener('click', async ()=>{
    if(!on){ await startAudio(); this.textContent='Music on ♪'; this.classList.add('hidden'); }
    else { stopAudio(); this.textContent='Tap for music ♪'; }
  });
})();
</script>

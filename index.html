<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>For Sâ¤ï¸</title>
  <meta name="theme-color" content="#ff4d6d" />
  <!-- minimal inline manifest -->
  <link rel="manifest" href='data:application/manifest+json,{"name":"For S â¤ï¸","short_name":"For S","start_url":".","display":"standalone","background_color":"#fff6f9","theme_color":"#ff4d6d"}'>
  <style>
    :root{
      --bg-main:#fff6f9;
      --bg-peach:#ffd9e2;
      --bg-rose:#ffafc6;
      --bg-lilac:#e9d5ff;

      --ink:#2b2b2b;
      --muted:#665c6f;
      --accent:#ff4d6d;
      --accent-2:#ffa6b7;
      --card:#ffffff;
      --ring:#ffd6de;
      --shadow: 0 20px 40px rgba(0,0,0,.08);
      --radius: 22px;
    }

    *{box-sizing:border-box}
    html,body{height:100%}

    body{
      margin:0;
      font-family: ui-sans-serif, -apple-system, system-ui, "Segoe UI",
      Roboto, "Helvetica Neue", Arial, "Apple Color Emoji", "Segoe UI Emoji";
      color:var(--ink);
      line-height:1.6;
      background-color:var(--bg-main);
      position:relative;
      overflow-x:hidden;

      background-image:
        radial-gradient(circle at 20% 20%, rgba(255,175,198,0.55) 0%, rgba(255,175,198,0) 60%),
        radial-gradient(circle at 80% 30%, rgba(233,213,255,0.5) 0%, rgba(233,213,255,0) 60%),
        radial-gradient(circle at 50% 80%, rgba(255,217,226,0.6) 0%, rgba(255,217,226,0) 65%),
        radial-gradient(ellipse at 50% 50%, #fff6f9 0%, #ffe8f0 40%, #ffdce7 60%, #fbe7ff 100%);
      background-repeat:no-repeat;
      background-size:140% 140%;
    }

    /* dreamy glow blobs behind the card stack */
    .bg-glow{
      position:fixed;
      inset:0;
      pointer-events:none;
      z-index:-1;
    }

    .glow-1,
    .glow-2,
    .glow-3{
      position:absolute;
      filter:blur(60px);
      opacity:.35;
      mix-blend-mode:screen;
      border-radius:50%;
    }

    .glow-1{
      width:320px;
      height:320px;
      left:-80px;
      top:-80px;
      background:radial-gradient(circle at 30% 30%,
        rgba(255,118,150,.55) 0%,
        rgba(255,118,150,0) 70%);
      animation:float1 8s ease-in-out infinite alternate;
    }

    .glow-2{
      width:360px;
      height:360px;
      right:-120px;
      top:0;
      background:radial-gradient(circle at 50% 30%,
        rgba(198,132,255,.45) 0%,
        rgba(198,132,255,0) 70%);
      animation:float2 9s ease-in-out infinite alternate;
    }

    .glow-3{
      width:460px;
      height:460px;
      left:50%;
      bottom:-180px;
      transform:translateX(-50%);
      background:radial-gradient(circle at 50% 50%,
        rgba(255,214,222,.55) 0%,
        rgba(255,214,222,0) 70%);
      animation:float3 10s ease-in-out infinite alternate;
    }

    @keyframes float1{
      0%   {transform:translateY(0) translateX(0) scale(1);}
      100% {transform:translateY(20px) translateX(10px) scale(1.05);}
    }
    @keyframes float2{
      0%   {transform:translateY(0) translateX(0) scale(1);}
      100% {transform:translateY(16px) translateX(-6px) scale(1.03);}
    }
    @keyframes float3{
      0%   {transform:translate(-50%,0) scale(1);}
      100% {transform:translate(-50%,18px) scale(1.06);}
    }

    /* subtle grain/noise overlay for cozy vibe */
    .grain{
      position:fixed;
      inset:0;
      pointer-events:none;
      z-index:-1;
      background-image:url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 200 200'%3E%3Cfilter id='n'%3E%3CfeTurbulence type='fractalNoise' baseFrequency='0.75' numOctaves='4' stitchTiles='stitch'/%3E%3C/filter%3E%3Crect width='200' height='200' filter='url(%23n)' opacity='.08'/%3E%3C/svg%3E");
      background-size:200px 200px;
      mix-blend-mode:soft-light;
    }

    .wrap{
      max-width:880px;
      margin:32px auto;
      padding:0 20px 80px;
      position:relative;
    }

    header.hero{
      background:linear-gradient(135deg,#fff,#fff6f8 55%,#ffeef3 100%);
      border:1px solid var(--ring);
      box-shadow:var(--shadow);
      border-radius:calc(var(--radius)+6px);
      padding:28px 28px 32px;
      position:relative;
      overflow:hidden;
    }
    .hero h1{margin:0 0 8px;font-size:clamp(28px,4.5vw,44px)}
    .badge{
      display:inline-block;
      padding:6px 12px;
      border-radius:999px;
      background:#fff;
      border:1px solid var(--ring);
      color:var(--muted);
      font-size:12px;
      letter-spacing:.3px;
      margin-top:10px
    }

    /* Floating animated heart */
    .heart{
      position:absolute;right:-24px;top:-24px;width:160px;height:160px;opacity:.15;
      background:
        radial-gradient(closest-side,var(--accent)93%,transparent94%) left,
        radial-gradient(closest-side,var(--accent)93%,transparent94%) right;
      background-size:50% 80%;background-repeat:no-repeat;
      clip-path:polygon(50%90%,0 45%,10%15%,35%0,50%10%,65%0,90%15%,100%45%);
      filter:blur(.5px);
      animation: heartFloat 8s ease-in-out infinite alternate;
    }
    @keyframes heartFloat{
      0%   { transform: translateY(0) rotate(12deg) scale(1); }
      50%  { transform: translateY(8px) rotate(15deg) scale(1.02); }
      100% { transform: translateY(14px) rotate(18deg) scale(1.03); }
    }

    .card{
      background:var(--card);
      border:1px solid var(--ring);
      border-radius:var(--radius);
      box-shadow:var(--shadow);
      padding:24px;
      margin-top:18px;
      backdrop-filter:blur(6px) saturate(1.2);
    }

    .grid{display:grid;gap:18px;grid-template-columns:repeat(12,1fr)}
    .col-7{grid-column:span 7}.col-5{grid-column:span 5}.col-6{grid-column:span 6}.col-12{grid-column:1/-1}
    @media(max-width:820px){
      .col-7,.col-5,.col-6{grid-column:1/-1}
    }

    .photo{
      width:100%;
      aspect-ratio:4/3;
      border-radius:18px;
      overflow:hidden;
      border:1px dashed #ffd3dc;
      display:grid;
      place-items:center;
      color:#b35a6a;
      background:repeating-linear-gradient(45deg,#fff8fa 0 10px,#fff 10px 20px);
      font-size:14px
    }
    .photo img{
      width:100%;
      height:100%;
      object-fit:cover;
      display:block;
    }
    .note{
      background:#fff8fa;
      border:1px solid #ffd6de;
      padding:12px 14px;
      border-radius:12px;
      font-size:14px;
      color:#7a6b79
    }
    h2.section-title{
      margin:0 0 12px;
      font-size:20px;
      display:flex;
      align-items:center;
      gap:10px
    }
    .dot{
      width:8px;
      height:8px;
      background:var(--accent);
      border-radius:50%
    }
    ul.love-list{margin:10px 0 0;padding:0 0 0 1rem}
    ul.love-list li{margin:6px 0}
    .blockquote{
      margin:6px 0 0;
      padding:14px 16px;
      border-left:3px solid var(--accent);
      background:#fff7f9;
      border-radius:8px
    }

    .cta{
      display:flex;
      flex-wrap:wrap;
      gap:12px;
      margin-top:12px
    }
    .cta button{
      border:none;
      outline:none;
      background:linear-gradient(180deg,#fff,#fff6f8);
      border:1px solid var(--accent-2);
      border-radius:999px;
      padding:12px 16px;
      font-weight:600;
      color:#b3264a;
      cursor:pointer;
      min-width:max-content;
      box-shadow:0 6px 18px rgba(255,77,109,.13);
      transition:transform .2s ease, box-shadow .2s ease;
    }
    .cta button:hover{
      transform:scale(1.05);
      box-shadow:0 10px 24px rgba(255,77,109,.22);
    }

    .signature{margin-top:14px;font-size:15px;color:#665c6f}
    footer{text-align:center;color:#8a7689;font-size:13px;margin-top:28px}

    @media print{
      body{background:#fff}.bg-glow,.grain,.heart{display:none}
      .card,.hero{box-shadow:none}
      .cta button{border:1px solid #bbb;box-shadow:none;background:#fff;color:#000}
    }

    /* ===== Floating popup (centered modal) ===== */
    .popup-backdrop{
      position:fixed;
      inset:0;
      background:rgba(0,0,0,.22);
      display:flex;
      align-items:center;
      justify-content:center;
      padding:16px;
      pointer-events:none;
      opacity:0;
      transition:opacity .2s ease;
      z-index:9999;
    }
    .popup-backdrop.active{
      pointer-events:auto;
      opacity:1;
    }
    .popup-card{
      width:100%;
      max-width:320px;
      background:linear-gradient(135deg,#fff,#fff6f8 55%,#ffeef3 100%);
      border:1px solid var(--ring);
      box-shadow:0 30px 60px rgba(0,0,0,.28);
      border-radius:18px;
      padding:16px 16px 14px;
      font-size:14px;
      color:var(--ink);
      line-height:1.45;
      position:relative;
      animation:floatUp .22s ease both;
      max-height:80vh;
      display:flex;
      flex-direction:column;
    }
    @keyframes floatUp{
      from{transform:translateY(10px) scale(.96);opacity:0}
      to{transform:translateY(0) scale(1);opacity:1}
    }
    .popup-close{
      position:absolute;
      top:8px;right:8px;
      background:#fff;
      color:#b3264a;
      border:1px solid var(--ring);
      border-radius:999px;
      font-size:12px;
      line-height:1;
      padding:4px 7px;
      cursor:pointer;
      box-shadow:0 8px 20px rgba(255,77,109,.18);
    }
    .popup-heading{
      font-weight:600;
      font-size:13px;
      color:#b3264a;
      display:flex;
      align-items:center;
      gap:6px;
      margin-bottom:8px;
      padding-right:28px;
    }
    .popup-dot{
      width:7px;height:7px;border-radius:50%;background:var(--accent);
      box-shadow:0 0 6px rgba(255,77,109,.6);
      flex-shrink:0;
    }
    .popup-scroll{
      overflow:auto;
      border-radius:12px;
      flex:1;
    }
    .popup-text{
      color:#2b2b2b;
      font-size:14px;
      font-weight:500;
    }
    .popup-sub{
      font-size:12px;
      color:#7a6b79;
      margin-top:10px;
      text-align:center;
      line-height:1.4;
    }
    .popup-actions{
      display:flex;
      gap:8px;
      justify-content:space-between;
      margin-top:12px;
    }
    .popup-btn{
      border:none;
      background:#fff;
      border:1px solid rgba(255,77,109,.25);
      border-radius:999px;
      padding:6px 10px;
      font-size:12px;
      color:#b3264a;
      cursor:pointer;
      flex:1;
      min-width:0;
    }
    .popup-btn.copy{
      flex:1.3;
      font-weight:600;
    }
    .popup-btn:active{
      transform:translateY(1px);
    }

    /* canvas for animated glowing hearts */
    .glow-canvas {
      position:fixed;
      inset:0;
      z-index:-1;
      pointer-events:none;
    }
  </style>
</head>
<body>

  <!-- dreamy glows behind content -->
  <div class="bg-glow">
    <div class="glow-1"></div>
    <div class="glow-2"></div>
    <div class="glow-3"></div>
  </div>

  <!-- soft grain overlay -->
  <div class="grain"></div>

  <div class="wrap">
    <header class="hero">
      <div class="heart"></div>
      <h1>To Sâ¤ï¸, with all my love â¤ï¸</h1>
      <span class="badge">From: M</span>
    </header>

    <section class="card">
      <div class="grid">
        <div class="col-7">
          <h2 class="section-title"><span class="dot"></span> A little note</h2>
          <div class="blockquote">
            Holaa bby, I made this little page because I wanted you to have
            something sweet you can open anytime. You make my days brighter, my laughs louder,
            and my heart so, so full. Thank you for being you. ğŸ’–
          </div>
          <p class="signature">Yours, M</p>
        </div>
        <div class="col-5">
          <div class="photo">
            <img
              src="https://raw.githubusercontent.com/lord42m/srks/466f1ff12280cb6d2e7bfd488ab13cbeb8a908f3/IMG_4386.jpeg"
              alt="Our favorite photo"
              loading="lazy"
            >
          </div>
          <p class="note" style="margin-top:10px">
            â¤ï¸â¤ï¸â¤ï¸â¤ï¸â¤ï¸â¤ï¸â¤ï¸â¤ï¸â¤ï¸â¤ï¸â¤ï¸â¤ï¸â¤ï¸â¤ï¸â¤ï¸
          </p>
        </div>
      </div>
    </section>

    <section class="card">
      <h2 class="section-title"><span class="dot"></span>Things I love about you</h2>
      <ul class="love-list">
        <li>Kamu yang selalu ada untuk tenangin dan dengarin aku</li>
        <li>Cara kamu perhatian dalam hal-hal kecil, yang bikin aku ngerasa disayang</li>
        <li>Kesabaranmu dalam menghadapi aku, yang bahkan aku sering capek sama diriku sendiri</li>
        <li>dan masih banyak lagiiiiiiiiiiiiiiiiiii</li>
      </ul>
    </section>

    <section class="card">
      <h2 class="section-title"><span class="dot"></span> Tiny promises</h2>
      <ul class="love-list">
        <li>More surprise and lot of kisses.</li>
        <li>Listening, even when words are messy.</li>
        <li>Cheering for you as always for everything you do.</li>
      </ul>

      <!-- BUTTONS -->
      <div class="cta">
        <button id="btnPlaylist" type="button">Our playlist ğŸµ</button>
        <button id="btnLove" type="button">Love U ğŸ’¬</button>
        <button id="btnLetter" type="button">Open letter âœ‰ï¸</button>
      </div>

      <p class="note">Kalau lagi bosen dengerin lagu disini yanggg</p>
    </section>

    <section class="card">
      <h2 class="section-title"><span class="dot"></span> Final whisper</h2>
      <p>
        Even though miles stretch between us, my heart feels you everywhere â€” in every song, every quiet morning, every late-night thought.  
        I miss you so much that in ways words canâ€™t quite capture, but itâ€™s the kind of missing that comes from loving someone so deeply it overflows.  
        Every time we talk, laugh, or share about our days, it reminds me that distance canâ€™t dim what we have â€” it only makes me love you and miss you more.
      </p>
      <p>
        I know this relation isnâ€™t always easy, but I want you to know that not a single day goes by without me being grateful for you.  
        The wait, the longing, the counting of days â€” theyâ€™re all worth it because soon, it wonâ€™t be a screen between us.  
        Iâ€™ll finally get to hold you, look you in the eyes, and tell you everything Iâ€™ve been saying from miles away:  
        <strong>I love you, endlessly and truly.</strong> ğŸ’
      </p>
      <p class="signature">Forever yours, <strong>M</strong></p>
    </section>

    <footer>
      â€¢Made with love ğŸ¥°â€¢
    </footer>
  </div>

  <!-- POPUP MODAL / REUSED FOR BUTTONS -->
  <div
    id="popupBackdrop"
    class="popup-backdrop"
    aria-hidden="true"
  >
    <div
      class="popup-card"
      id="popupCard"
      role="dialog"
      aria-modal="true"
      aria-labelledby="popupTitle"
    >
      <button class="popup-close" id="popupCloseBtn" type="button">âœ•</button>
      <div class="popup-heading">
        <span class="popup-dot"></span>
        <span id="popupTitle">Title</span>
      </div>
      <div class="popup-scroll" id="popupBody">
        <!-- dynamic content -->
      </div>
    </div>
  </div>

  <!-- floating glowing hearts canvas -->
  <canvas id="heartsCanvas" class="glow-canvas"></canvas>

  <script>
    // =========================
    // 1. DATA
    // =========================
    const quotes = [
      "Jarak cuma ngetes sabar, bukan nurunin rasa. Aku tetep milih kamu. ğŸ’•",
      "Nggak apa-apa hari ini capek. Aku tetep di sini, tim kamu selalu. ğŸ’",
      "Kita nggak perfect, tapi kita selalu balik lagi ke satu sama lain. Itu yang penting. ğŸŒ¸",
      "Youâ€™re allowed to feel tired. Iâ€™ll hold the world for a bit while you rest. ğŸ’—",
      "Hubungan itu kerja sama. Aku jagain kamu, kamu jagain aku. Weâ€™re a team. ğŸ¤",
      "Kalo lagi ragu, inget ini: aku sayang kamu beneran. Ga main-main. ğŸ«¶",
      "Semua yang berat bakal lewat. Tapi aku nggak akan lewat. Aku stay. ğŸ’«",
      "Aku nggak butuh kata-kata manis, cukup kamu yang nyata. â¤ï¸",
      "Hari yang berat jadi ringan waktu aku inget kamu. ğŸŒ¤ï¸",
      "Kamu tuh rumah paling tenang setelah dunia capek banget. ğŸ¡",
      "Aku nggak butuh alasan buat cinta kamu, aku cuma tahu aku nyaman di kamu. ğŸ’",
      "Nggak semua hari harus sempurna, yang penting kita tetap saling. ğŸŒ·",
      "Kalau aku bisa pilih tempat buat hidup selamanya, aku pilih di hati kamu. ğŸ’–",
      "Kamu nggak sadar, tapi kehadiranmu aja udah bikin segalanya terasa lebih baik. â˜€ï¸",
      "Aku nggak nyari yang sempurna, aku nyari yang mau jalan bareng terus meski susah. ğŸš¶â€â™€ï¸ğŸš¶â€â™‚ï¸",
      "Jarak nggak bisa matiin rasa, cuma bikin rindu tumbuh lebih kuat. ğŸ’Œ",
      "Aku mau terus jadi alasan kamu senyum, walau cuma lewat layar. ğŸ“±",
      "Cinta itu bukan tentang siapa yang duluan datang, tapi siapa yang mau tetap tinggal. ğŸ’—",
      "Kamu adalah hal paling indah yang nggak sengaja aku temuin. âœ¨",
      "Aku suka caramu sabar ngadepin aku yang kadang nggak jelas. ğŸ’•",
      "Gak apa-apa dunia keras, asal pelukmu tetap lembut. ğŸ¤",
      "Kamu itu bukan cuma prioritas, tapi doa yang selalu kusebut. ğŸ™ğŸ’",
      "Cinta kita nggak butuh validasi, cukup dua hati yang ngerti. ğŸ’˜",
      "Kalau kamu tanya aku mau apa, jawabannya: kamu, terus, dan selamanya. â™¾ï¸",
      "Sabar bukan berarti nggak capek, tapi karena ada kamu yang layak ditunggu. ğŸ•°ï¸",
      "Kita gak harus selalu romantis, yang penting nyata dan saling ngerti. ğŸ’«",
      "Aku pengen jadi orang pertama yang kamu ceritain tentang hal kecil sekalipun. â˜•",
      "Nggak ada jarak sejauh doa. Aku doa kamu tiap hari. ğŸŒ™",
      "Senyummu tuh semacam obat, tapi aku gak mau sembuh. ğŸ˜Œ",
      "Mau seberat apa pun hari ini, inget ya, aku tetap di sini buat kamu. ğŸ’Œ",
      "Aku suka caramu bikin hal kecil jadi terasa spesial. ğŸ¥°",
      "Kamu nggak perlu berubah jadi orang lain, aku suka kamu yang sekarang. ğŸ’•",
      "Waktu nggak bisa balikin apa pun, tapi aku janji gak nyia-nyiain kamu. ğŸ’",
      "Setiap hari aku jatuh cinta lagi ke kamu, dengan cara yang beda. ğŸ’—",
      "Kamu tuh bukan cuma pasangan, tapi juga rumah, sahabat, dan tempat pulang. ğŸ ",
      "Kamu nggak harus selalu kuat, kadang kamu juga boleh istirahat di bahuku. ğŸ¤",
      "Nggak semua cinta harus ribut soal siapa yang benar, kadang cukup siapa yang sabar. ğŸ’«",
      "Kita berdua mungkin gak sempurna, tapi kita pas buat saling ngisi. ğŸ’",
      "Kalau cinta bisa diukur, cintaku ke kamu udah gak muat di dunia. ğŸŒâ¤ï¸",
      "Nggak peduli hari ini kayak gimana, aku tetap bersyukur kamu ada. â˜€ï¸",
      "Aku nggak butuh bunga tiap hari, cukup kamu yang tumbuh bareng aku. ğŸŒ·",
      "Kamu bukan cuma kisah cinta, tapi juga alasan aku belajar sabar. ğŸ“–",
      "Kadang aku capek, tapi inget kamu bikin aku semangat lagi. ğŸ’—",
      "Kamu tuh kayak kopi pagi, hangat dan bikin hidup lebih hidup. â˜•",
      "Aku gak minta kamu sempurna, cukup jujur dan tetap di sini. ğŸ’•",
      "Kamu nggak perlu ngomong banyak, cukup genggaman tanganmu udah tenangin. ğŸ¤",
      "Aku mau bareng kamu, bukan cuma pas seneng, tapi juga pas lagi berantakan. ğŸ’",
      "Setiap detik sama kamu tuh doa kecil yang aku syukuri. ğŸ™",
      "Aku gak tahu masa depan kayak apa, tapi aku pengen kamu di situ. â™¾ï¸",
      "Kamu nggak cuma bagian dari hidupku, tapi seluruh alasannya. â¤ï¸"
    ];

    const QUOTE_STORAGE_KEY = 'for_s_last_quote';

    // =========================
    // 2. POPUP / MODAL
    // =========================
    const popupBackdrop = document.getElementById('popupBackdrop');
    const popupTitle = document.getElementById('popupTitle');
    const popupBody = document.getElementById('popupBody');
    const popupCloseBtn = document.getElementById('popupCloseBtn');

    function closePopup() {
      popupBackdrop.classList.remove('active');
      popupBackdrop.setAttribute('aria-hidden','true');
      popupBody.innerHTML = "";
    }

    function openPopup({ title, html }) {
      popupTitle.textContent = title;
      popupBody.innerHTML = html;
      popupBackdrop.classList.add('active');
      popupBackdrop.setAttribute('aria-hidden','false');
    }

    // =========================
    // 3. LOVE QUOTES POPUP (with cycle + copy + saved index)
    // =========================
    let currentQuoteIndex = 0;

    function saveQuoteIndex(idx) {
      try {
        localStorage.setItem(QUOTE_STORAGE_KEY, String(idx));
      } catch (e) {
        // ignore if private mode
      }
    }

    function loadQuoteIndex() {
      try {
        const v = localStorage.getItem(QUOTE_STORAGE_KEY);
        if (v === null) return null;
        const num = Number(v);
        if (Number.isNaN(num)) return null;
        if (num < 0 || num >= quotes.length) return null;
        return num;
      } catch (e) {
        return null;
      }
    }

    function renderQuoteContent() {
      const quoteEl = document.getElementById('quoteText');
      if (!quoteEl) return;
      const q = quotes[currentQuoteIndex];
      quoteEl.textContent = q;
    }

    function openQuotesPopup(startIndex) {
      // decide which index to use
      let idx = null;
      if (typeof startIndex === 'number') {
        idx = startIndex;
      } else {
        const saved = loadQuoteIndex();
        if (saved !== null) {
          idx = saved;
        } else {
          // fallback random
          idx = Math.floor(Math.random() * quotes.length);
        }
      }
      currentQuoteIndex = idx;
      const html = `
        <div class="popup-text" id="quoteText" style="padding:8px 4px 0 4px;"></div>
        <div class="popup-sub">
          Loveeee U â¤ï¸.
        </div>
        <div class="popup-actions" id="quoteActions">
          <button type="button" class="popup-btn" data-action="prev">â† Prev</button>
          <button type="button" class="popup-btn copy" data-action="copy">Copy ğŸ’Œ</button>
          <button type="button" class="popup-btn" data-action="next">Next â†’</button>
        </div>
      `;
      openPopup({
        title: "Love u ğŸ’¬",
        html
      });
      renderQuoteContent();
      saveQuoteIndex(currentQuoteIndex);
      playSoftChime();
    }

    function goToNextQuote() {
      currentQuoteIndex = (currentQuoteIndex + 1) % quotes.length;
      renderQuoteContent();
      saveQuoteIndex(currentQuoteIndex);
    }

    function goToPrevQuote() {
      currentQuoteIndex = (currentQuoteIndex - 1 + quotes.length) % quotes.length;
      renderQuoteContent();
      saveQuoteIndex(currentQuoteIndex);
    }

    async function copyCurrentQuote() {
      const q = quotes[currentQuoteIndex];
      try {
        await navigator.clipboard.writeText(q);
        const copyBtn = popupBody.querySelector('[data-action="copy"]');
        if (copyBtn) {
          const old = copyBtn.textContent;
          copyBtn.textContent = "Copied âœ…";
          setTimeout(() => copyBtn.textContent = old, 1500);
        }
      } catch (err) {
        alert("Gagal copy, tapi kamu masih cantik ğŸ˜Œ");
      }
    }

    // =========================
    // 4. LETTER POPUP
    // =========================
    function showLetter() {
      const html = `
        <div class="popup-text" style="padding:4px 2px 0 2px;">
          Hi sayangku â¤ï¸<br><br>
          Just in case hari ini kamu lagi ngerasa capek atau kepikiran banyak hal,
          aku mau kamu inget satu hal: kamu itu hal baik yang Tuhan titipin ke aku.
          Kamu lembut, perhatian, dan kamu selalu nyoba ngerti aku bahkan pas aku sendiri nggak ngerti diriku.
          <br><br>
          Aku bangga banget sama kamu. Sama semua hal yang kamu kejar, sama semua hal yang kamu tahan,
          sama caramu milih buat tetap stay di hubungan ini meski jarak dan waktu kadang nggak ramah.
          <br><br>
          Jadi kalo suatu hari kamu ragu, buka ini lagi ya.
          Aku nggak ke mana-mana. Iâ€™m choosing you, over and over. ğŸ’Œ
        </div>
        <div class="popup-sub">
          - your M ğŸ¤
        </div>
      `;
      openPopup({
        title: "A little letter âœ‰ï¸",
        html
      });
    }

    // =========================
    // 5. SPOTIFY
    // =========================
    function openSpotify() {
      window.location = 'spotify:playlist:3BBdBzOrmW88fxN50IDeWu';
      setTimeout(() => {
        window.open('https://open.spotify.com/playlist/3BBdBzOrmW88fxN50IDeWu', '_blank');
      }, 500);
    }

    // =========================
    // 6. SOFT AUDIO (Web Audio, no file)
    // =========================
    let audioCtx = null;
    function playSoftChime() {
      try {
        if (!audioCtx) {
          audioCtx = new (window.AudioContext || window.webkitAudioContext)();
        }
        const now = audioCtx.currentTime;
        const osc = audioCtx.createOscillator();
        const gain = audioCtx.createGain();
        osc.type = "sine";
        osc.frequency.setValueAtTime(660, now);
        gain.gain.setValueAtTime(0.0001, now);
        gain.gain.exponentialRampToValueAtTime(0.35, now + 0.03);
        gain.gain.exponentialRampToValueAtTime(0.0001, now + 0.6);
        osc.connect(gain).connect(audioCtx.destination);
        osc.start(now);
        osc.stop(now + 0.6);
      } catch (e) {}
    }

    // =========================
    // 7. FLOATING HEARTS CANVAS
    // =========================
    const canvas = document.getElementById("heartsCanvas");
    const ctx = canvas.getContext("2d");

    let hearts = [];
    const HEART_COUNT = 28;

    function resizeCanvas() {
      canvas.width = window.innerWidth;
      canvas.height = window.innerHeight;
      hearts = Array.from({length: HEART_COUNT}, () => new Heart());
    }

    class Heart {
      constructor() {
        this.reset();
      }
      reset() {
        this.x = Math.random() * canvas.width;
        this.y = canvas.height + 40;
        this.size = Math.random() * 14 + 10;
        this.speedY = Math.random() * 0.7 + 0.4;
        this.driftX = (Math.random() - 0.5) * 0.5;
        this.alpha = Math.random() * 0.4 + 0.4;
        this.lifeFade = Math.random() * 0.0009 + 0.0009;

        const palette = [
          {r:255,g:77,b:109},
          {r:255,g:140,b:170},
          {r:255,g:184,b:200},
          {r:226,g:134,b:255},
        ];
        this.color = palette[Math.floor(Math.random()*palette.length)];
      }
      step() {
        this.y -= this.speedY;
        this.x += this.driftX;
        this.alpha -= this.lifeFade;
        if (this.alpha <= 0 || this.y < -40) {
          this.reset();
          this.y = canvas.height + 40;
        }
      }
      draw(ctx) {
        const drawHeartShape = (scale=1) => {
          const s = this.size * scale;
          ctx.beginPath();
          ctx.moveTo(0, -0.3*s);
          ctx.bezierCurveTo(0, -0.6*s, -0.6*s, -0.6*s, -0.6*s, -0.15*s);
          ctx.bezierCurveTo(-0.6*s, 0.1*s, -0.3*s, 0.35*s, 0, 0.55*s);
          ctx.bezierCurveTo(0.3*s, 0.35*s, 0.6*s, 0.1*s, 0.6*s, -0.15*s);
          ctx.bezierCurveTo(0.6*s, -0.6*s, 0, -0.6*s, 0, -0.3*s);
          ctx.closePath();
        };

        ctx.save();
        ctx.translate(this.x, this.y);

        // outer glow
        ctx.save();
        ctx.globalAlpha = this.alpha * 0.5;
        ctx.shadowColor = `rgba(${this.color.r},${this.color.g},${this.color.b},0.8)`;
        ctx.shadowBlur = this.size * 1.5;
        ctx.fillStyle = `rgba(${this.color.r},${this.color.g},${this.color.b},0.25)`;
        drawHeartShape(1.4);
        ctx.fill();
        ctx.restore();

        // inner heart
        ctx.save();
        ctx.globalAlpha = this.alpha;
        ctx.fillStyle = `rgba(${this.color.r},${this.color.g},${this.color.b},1)`;
        ctx.strokeStyle = `rgba(255,255,255,0.6)`;
        ctx.lineWidth = 0.6;
        drawHeartShape(1.0);
        ctx.fill();
        ctx.stroke();
        ctx.restore();

        ctx.restore();
      }
    }

    function animate() {
      ctx.clearRect(0,0,canvas.width,canvas.height);
      hearts.forEach(h => {
        h.step();
        h.draw(ctx);
      });
      requestAnimationFrame(animate);
    }

    // =========================
    // 8. PWA-ish: register SW from inline blob
    // =========================
    (function registerSW(){
      if ('serviceWorker' in navigator) {
        const swCode = `
          const CACHE = 'for-s-v1';
          self.addEventListener('install', (e) => {
            e.waitUntil(caches.open(CACHE).then(c => c.addAll(['./'])).catch(()=>{}));
            self.skipWaiting();
          });
          self.addEventListener('activate', (e) => {
            e.waitUntil(self.clients.claim());
          });
          self.addEventListener('fetch', (e) => {
            e.respondWith(
              fetch(e.request).catch(() => caches.match(e.request))
            );
          });
        `;
        const blob = new Blob([swCode], {type: 'text/javascript'});
        const swUrl = URL.createObjectURL(blob);
        navigator.serviceWorker.register(swUrl).catch(()=>{});
      }
    })();

    // =========================
    // 9. DOM Ready wiring
    // =========================
    document.addEventListener('DOMContentLoaded', () => {
      const btnPlaylist = document.getElementById('btnPlaylist');
      const btnLove = document.getElementById('btnLove');
      const btnLetter = document.getElementById('btnLetter');

      btnPlaylist.addEventListener('click', openSpotify);
      btnLove.addEventListener('click', () => {
        openQuotesPopup(); // now it will try saved index first
      });
      btnLetter.addEventListener('click', showLetter);

      // popup close btn
      popupCloseBtn.addEventListener('click', closePopup);

      // click on backdrop to close
      popupBackdrop.addEventListener('click', (e) => {
        if (e.target === popupBackdrop) {
          closePopup();
        }
      });

      // handle actions in popup (delegation)
      popupBody.addEventListener('click', (e) => {
        const btn = e.target.closest('[data-action]');
        if (!btn) return;
        const action = btn.getAttribute('data-action');
        if (action === 'next') goToNextQuote();
        else if (action === 'prev') goToPrevQuote();
        else if (action === 'copy') copyCurrentQuote();
      });

      // esc to close
      document.addEventListener('keydown', (e) => {
        if (e.key === 'Escape' && popupBackdrop.classList.contains('active')) {
          closePopup();
        }
      });

      // canvas init
      resizeCanvas();
      animate();
    });

    window.addEventListener("resize", resizeCanvas);
  </script>
</body>
</html>

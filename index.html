<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>For S‚ù§Ô∏è</title>
  <meta name="theme-color" content="#ff4d6d" />
  <link rel="manifest" href='data:application/manifest+json,{"name":"For S ‚ù§Ô∏è","short_name":"For S","start_url":".","display":"standalone","background_color":"#fff6f9","theme_color":"#ff4d6d"}'>
  <style>
    :root{
      --bg-main:#fff6f9;
      --ink:#2b2b2b;
      --muted:#665c6f;
      --accent:#ff4d6d;
      --accent-2:#ffa6b7;
      --card:#ffffff;
      --ring:#ffd6de;
      --shadow: 0 20px 40px rgba(0,0,0,.08);
      --radius: 22px;
    }
    *{box-sizing:border-box}
    html,body{height:100%}
    body{
      margin:0;
      font-family: ui-sans-serif, -apple-system, system-ui, "Segoe UI",
      Roboto, "Helvetica Neue", Arial, "Apple Color Emoji", "Segoe UI Emoji";
      color:var(--ink);
      line-height:1.6;
      background-color:var(--bg-main);
      position:relative;
      overflow-x:hidden;
      background-image:
        radial-gradient(circle at 20% 20%, rgba(255,175,198,0.55) 0%, rgba(255,175,198,0) 60%),
        radial-gradient(circle at 80% 30%, rgba(233,213,255,0.5) 0%, rgba(233,213,255,0) 60%),
        radial-gradient(circle at 50% 80%, rgba(255,217,226,0.6) 0%, rgba(255,217,226,0) 65%),
        radial-gradient(ellipse at 50% 50%, #fff6f9 0%, #ffe8f0 40%, #ffdce7 60%, #fbe7ff 100%);
      background-repeat:no-repeat;
      background-size:140% 140%;
    }
    body.locked{overflow:hidden;}

    .bg-glow{
      position:fixed;
      inset:0;
      pointer-events:none;
      z-index:-1;
    }
    .bg-glow > div{
      position:absolute;
      filter:blur(60px);
      opacity:.35;
      mix-blend-mode:screen;
      border-radius:50%;
    }
    .glow-1{width:320px;height:320px;left:-80px;top:-80px;background:radial-gradient(circle at 30% 30%,rgba(255,118,150,.55) 0%,rgba(255,118,150,0) 70%);animation:float1 8s ease-in-out infinite alternate;}
    .glow-2{width:360px;height:360px;right:-120px;top:0;background:radial-gradient(circle at 50% 30%,rgba(198,132,255,.45) 0%,rgba(198,132,255,0) 70%);animation:float2 9s ease-in-out infinite alternate;}
    .glow-3{width:460px;height:460px;left:50%;bottom:-180px;transform:translateX(-50%);background:radial-gradient(circle at 50% 50%,rgba(255,214,222,.55) 0%,rgba(255,214,222,0) 70%);animation:float3 10s ease-in-out infinite alternate;}
    @keyframes float1{0%{transform:translateY(0)}100%{transform:translateY(20px)}}
    @keyframes float2{0%{transform:translateY(0)}100%{transform:translateY(16px)}}
    @keyframes float3{0%{transform:translate(-50%,0)}100%{transform:translate(-50%,18px)}}

    .grain{
      position:fixed;
      inset:0;
      pointer-events:none;
      z-index:-1;
      background-image:url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 200 200'%3E%3Cfilter id='n'%3E%3CfeTurbulence type='fractalNoise' baseFrequency='0.75' numOctaves='4' stitchTiles='stitch'/%3E%3C/filter%3E%3Crect width='200' height='200' filter='url(%23n)' opacity='.08'/%3E%3C/svg%3E");
      background-size:200px 200px;
      mix-blend-mode:soft-light;
    }

    .wrap{max-width:880px;margin:32px auto;padding:0 20px 80px;position:relative;}
    header.hero{
      background:linear-gradient(135deg,#fff,#fff6f8 55%,#ffeef3 100%);
      border:1px solid var(--ring);
      box-shadow:var(--shadow);
      border-radius:calc(var(--radius)+6px);
      padding:28px 28px 32px;
      position:relative;
      overflow:hidden;
    }
    .hero h1{margin:0 0 8px;font-size:clamp(28px,4.5vw,44px)}
    .badge{
      display:inline-block;
      padding:6px 12px;
      border-radius:999px;
      background:#fff;
      border:1px solid var(--ring);
      color:var(--muted);
      font-size:12px;
      margin-top:10px
    }
    .heart{
      position:absolute;right:-24px;top:-24px;width:160px;height:160px;opacity:.15;
      background:
        radial-gradient(closest-side,var(--accent)93%,transparent94%) left,
        radial-gradient(closest-side,var(--accent)93%,transparent94%) right;
      background-size:50% 80%;background-repeat:no-repeat;
      clip-path:polygon(50%90%,0 45%,10%15%,35%0,50%10%,65%0,90%15%,100%45%);
      animation: heartFloat 8s ease-in-out infinite alternate;
    }
    @keyframes heartFloat{0%{transform:translateY(0) rotate(12deg) scale(1)}100%{transform:translateY(14px) rotate(18deg) scale(1.03)}}

    .card{
      background:var(--card);
      border:1px solid var(--ring);
      border-radius:var(--radius);
      box-shadow:var(--shadow);
      padding:24px;
      margin-top:18px;
      backdrop-filter:blur(6px) saturate(1.2);
    }

    .grid{display:grid;gap:18px;grid-template-columns:repeat(12,1fr)}
    .col-7{grid-column:span 7}.col-5{grid-column:span 5}
    @media(max-width:820px){.col-7,.col-5{grid-column:1/-1}}

    .photo{width:100%;aspect-ratio:4/3;border-radius:18px;overflow:hidden;border:1px dashed #ffd3dc;display:grid;place-items:center;background:#fff;}
    .photo img{width:100%;height:100%;object-fit:cover;display:block;}
    .note{background:#fff8fa;border:1px solid #ffd6de;padding:12px 14px;border-radius:12px;font-size:14px;color:#7a6b79}

    h2.section-title{margin:0 0 12px;font-size:20px;display:flex;align-items:center;gap:10px}
    .dot{width:8px;height:8px;background:var(--accent);border-radius:50%}
    ul.love-list{margin:10px 0 0;padding:0 0 0 1rem}
    ul.love-list li{margin:6px 0}
    .blockquote{margin:6px 0 0;padding:14px 16px;border-left:3px solid var(--accent);background:#fff7f9;border-radius:8px}

    .cta{display:flex;flex-wrap:wrap;gap:12px;margin-top:12px}
    .cta button{
      border:none;outline:none;
      background:linear-gradient(180deg,#fff,#fff6f8);
      border:1px solid var(--accent-2);
      border-radius:999px;
      padding:12px 16px;
      font-weight:600;
      color:#b3264a;
      cursor:pointer;
      min-width:max-content;
      box-shadow:0 6px 18px rgba(255,77,109,.13);
      transition:transform .2s ease, box-shadow .2s ease;
    }
    .cta button:hover{transform:scale(1.05);box-shadow:0 10px 24px rgba(255,77,109,.22);}
    .signature{margin-top:14px;font-size:15px;color:#665c6f}
    footer{text-align:center;color:#8a7689;font-size:13px;margin-top:28px}

    .popup-backdrop{
      position:fixed;inset:0;background:rgba(0,0,0,.22);
      display:flex;align-items:center;justify-content:center;
      padding:16px;pointer-events:none;opacity:0;
      transition:opacity .2s ease;z-index:9999;
    }
    .popup-backdrop.active{pointer-events:auto;opacity:1;}
    .popup-card{
      width:100%;max-width:320px;
      background:linear-gradient(135deg,#fff,#fff6f8 55%,#ffeef3 100%);
      border:1px solid var(--ring);box-shadow:0 30px 60px rgba(0,0,0,.28);
      border-radius:18px;padding:16px 16px 14px;font-size:14px;color:var(--ink);
      line-height:1.45;position:relative;animation:floatUp .22s ease both;
      max-height:80vh;display:flex;flex-direction:column;
    }
    @keyframes floatUp{from{transform:translateY(10px) scale(.96);opacity:0}to{transform:translateY(0) scale(1);opacity:1}}
    .popup-close{
      position:absolute;top:8px;right:8px;background:#fff;color:#b3264a;
      border:1px solid var(--ring);border-radius:999px;font-size:12px;
      line-height:1;padding:4px 7px;cursor:pointer;box-shadow:0 8px 20px rgba(255,77,109,.18);
    }
    .popup-heading{font-weight:600;font-size:13px;color:#b3264a;display:flex;align-items:center;gap:6px;margin-bottom:8px;padding-right:28px;}
    .popup-dot{width:7px;height:7px;border-radius:50%;background:var(--accent);box-shadow:0 0 6px rgba(255,77,109,.6);flex-shrink:0;}
    .popup-scroll{overflow:auto;border-radius:12px;flex:1;}
    .popup-text{color:#2b2b2b;font-size:14px;font-weight:500;}
    .popup-sub{font-size:12px;color:#7a6b79;margin-top:10px;text-align:center;line-height:1.4;}
    .popup-actions{display:flex;gap:8px;justify-content:space-between;margin-top:12px;}
    .popup-btn{border:none;background:#fff;border:1px solid rgba(255,77,109,.25);border-radius:999px;padding:6px 10px;font-size:12px;color:#b3264a;cursor:pointer;flex:1}
    .popup-btn.copy{flex:1.3;font-weight:600}

    .glow-canvas{position:fixed;inset:0;z-index:-1;pointer-events:none;}

    /* love gate */
    .love-gate{
      position:fixed;inset:0;background:rgba(255,246,249,.95);
      display:flex;align-items:center;justify-content:center;
      z-index:100000;transition:opacity .2s ease;
    }
    .love-gate.hide{opacity:0;pointer-events:none;}
    .love-gate-card{
      background:#fff;border:1px solid rgba(255,77,109,.35);
      border-radius:20px;padding:18px 18px 16px;
      width:min(320px,90vw);text-align:center;
      box-shadow:0 18px 35px rgba(0,0,0,.15);
      position:absolute;
      transition:transform .25s ease;
    }
    .love-gate h2{margin:0 0 6px;font-size:16px;color:#b3264a}
    .love-gate p{margin:0 0 12px;font-size:13px;color:#665c6f}
    .love-gate .gate-actions{display:flex;gap:10px;justify-content:center;}
    .love-btn{border:none;border-radius:999px;padding:8px 14px;font-size:13px;cursor:pointer;}
    .love-yes{background:linear-gradient(180deg,#fff6f9,#ffd7df);border:1px solid rgba(255,77,109,.5);color:#b3264a;font-weight:600;box-shadow:0 10px 14px rgba(255,77,109,.25);}
    .love-no{background:#fff;border:1px solid rgba(0,0,0,.08);color:#665c6f;}

    /* small overlay for "i'm mad" / "love u too" */
    .love-msg-overlay{
      position:fixed;inset:0;background:rgba(0,0,0,.25);
      display:flex;align-items:center;justify-content:center;
      z-index:100001;opacity:0;pointer-events:none;
      transition:opacity .2s ease;
    }
    .love-msg-overlay.show{opacity:1;pointer-events:auto;}
    .love-msg-card{
      background:#fff;
      border:1px solid rgba(255,77,109,.35);
      border-radius:18px;
      padding:16px 16px 14px;
      width:min(300px,90vw);
      text-align:center;
      box-shadow:0 16px 32px rgba(0,0,0,.18);
      animation:floatUp .2s ease;
    }
    .love-msg-card h3{margin:0 0 6px;font-size:15px;color:#b3264a}
    .love-msg-card p{margin:0 0 10px;font-size:13px;color:#665c6f}
    .love-msg-card button{
      border:none;
      background:linear-gradient(180deg,#fff6f9,#ffd7df);
      border:1px solid rgba(255,77,109,.5);
      border-radius:999px;
      padding:7px 14px;
      font-size:13px;
      color:#b3264a;
      font-weight:600;
      cursor:pointer;
    }

    /* music choice */
    .music-choice{
      position:fixed;inset:0;background:rgba(0,0,0,.18);
      display:flex;align-items:center;justify-content:center;
      z-index:99990;opacity:0;pointer-events:none;transition:opacity .2s ease;
    }
    .music-choice.active{opacity:1;pointer-events:auto;}
    .music-card{
      background:#fff;border:1px solid rgba(255,77,109,.3);
      border-radius:20px;padding:16px 16px 12px;
      width:min(330px,90vw);text-align:center;box-shadow:0 18px 40px rgba(0,0,0,.12);
    }
    .music-card h3{margin:0 0 6px;font-size:15px;color:#b3264a}
    .music-card p{margin:0 0 10px;font-size:13px;color:#665c6f}
    .music-card .mc-actions{display:flex;gap:10px;justify-content:center;}
    .mc-btn{border:none;border-radius:999px;padding:7px 14px;font-size:13px;cursor:pointer;}
    .mc-yes{background:linear-gradient(180deg,#fff6f9,#ffd7df);border:1px solid rgba(255,77,109,.5);color:#b3264a;font-weight:600;}
    .mc-no{background:#fff;border:1px solid rgba(0,0,0,.08);color:#665c6f;}
  </style>
</head>
<body class="locked">
  <div class="bg-glow">
    <div class="glow-1"></div>
    <div class="glow-2"></div>
    <div class="glow-3"></div>
  </div>
  <div class="grain"></div>

  <div class="wrap">
    <header class="hero">
      <div class="heart"></div>
      <h1>To S‚ù§Ô∏è, with all my love ‚ù§Ô∏è</h1>
      <span class="badge">From: M</span>
    </header>

    <section class="card">
      <div class="grid">
        <div class="col-7">
          <h2 class="section-title"><span class="dot"></span> A little note</h2>
          <div class="blockquote">
            Holaa bby, I made this little page because I wanted you to have
            something sweet you can open anytime. You make my days brighter, my laughs louder,
            and my heart so, so full. Thank you for being you. üíñ
          </div>
          <p class="signature">Yours, M</p>
        </div>
        <div class="col-5">
          <div class="photo">
            <img
              src="https://raw.githubusercontent.com/lord42m/srks/466f1ff12280cb6d2e7bfd488ab13cbeb8a908f3/IMG_4386.jpeg"
              alt="Our favorite photo"
              loading="lazy"
            >
          </div>
          <p class="note" style="margin-top:10px">
            ‚ù§Ô∏è‚ù§Ô∏è‚ù§Ô∏è‚ù§Ô∏è‚ù§Ô∏è‚ù§Ô∏è‚ù§Ô∏è‚ù§Ô∏è‚ù§Ô∏è‚ù§Ô∏è‚ù§Ô∏è‚ù§Ô∏è‚ù§Ô∏è‚ù§Ô∏è‚ù§Ô∏è
          </p>
        </div>
      </div>
    </section>

    <section class="card">
      <h2 class="section-title"><span class="dot"></span>Things I love about you</h2>
      <ul class="love-list">
        <li>Kamu yang selalu ada untuk tenangin dan dengarin aku</li>
        <li>Cara kamu perhatian dalam hal-hal kecil, yang bikin aku ngerasa disayang</li>
        <li>Kesabaranmu dalam menghadapi aku, yang bahkan aku sering capek sama diriku sendiri</li>
        <li>dan masih banyak lagiiiiiiiiiiiiiiiiiii</li>
      </ul>
    </section>

    <section class="card">
      <h2 class="section-title"><span class="dot"></span> Tiny promises</h2>
      <ul class="love-list">
        <li>More surprise and lot of kisses.</li>
        <li>Listening, even when words are messy.</li>
        <li>Cheering for you as always for everything you do.</li>
      </ul>
      <div class="cta">
        <button id="btnPlaylist" type="button">Our playlist üéµ</button>
        <button id="btnLove" type="button">Love U üí¨</button>
        <button id="btnLetter" type="button">Open letter ‚úâÔ∏è</button>
      </div>
      <p class="note">Kalau lagi bosen dengerin lagu disini yanggg</p>
    </section>

    <section class="card">
      <h2 class="section-title"><span class="dot"></span> Final whisper</h2>
      <p>
        Even though miles stretch between us, my heart feels you everywhere ‚Äî in every song, every quiet morning, every late-night thought.  
        I miss you so much that in ways words can‚Äôt quite capture, but it‚Äôs the kind of missing that comes from loving someone so deeply it overflows.  
        Every time we talk, laugh, or share about our days, it reminds me that distance can‚Äôt dim what we have ‚Äî it only makes me love you and miss you more.
      </p>
      <p>
        I know this relation isn‚Äôt always easy, but I want you to know that not a single day goes by without me being grateful for you.  
        The wait, the longing, the counting of days ‚Äî they‚Äôre all worth it because soon, it won‚Äôt be a screen between us.  
        I‚Äôll finally get to hold you, look you in the eyes, and tell you everything I‚Äôve been saying from miles away:  
        <strong>I love you, endlessly and truly.</strong> üíû
      </p>
      <p class="signature">Forever yours, <strong>M</strong></p>
    </section>

    <footer>‚Ä¢Made with love ü•∞‚Ä¢</footer>
  </div>

  <!-- main popup -->
  <div id="popupBackdrop" class="popup-backdrop" aria-hidden="true">
    <div class="popup-card" id="popupCard" role="dialog" aria-modal="true" aria-labelledby="popupTitle">
      <button class="popup-close" id="popupCloseBtn" type="button">‚úï</button>
      <div class="popup-heading">
        <span class="popup-dot"></span>
        <span id="popupTitle">Title</span>
      </div>
      <div class="popup-scroll" id="popupBody"></div>
    </div>
  </div>

  <!-- canvas hearts -->
  <canvas id="heartsCanvas" class="glow-canvas"></canvas>

  <!-- 1) LOVE GATE -->
  <div id="loveGate" class="love-gate">
    <div id="loveGateCard" class="love-gate-card">
      <h2>Do you love me? ü•∫‚ù§Ô∏è</h2>
      <p>Katakan jujur yaaa, baru boleh masuk üíó</p>
      <div class="gate-actions">
        <button id="loveYes" class="love-btn love-yes" type="button">Yes, i love u ‚ù§Ô∏è</button>
        <button id="loveNo" class="love-btn love-no" type="button">No üíî</button>
      </div>
    </div>
  </div>

  <!-- mini message popup (angry / love) -->
  <div id="loveMsgOverlay" class="love-msg-overlay">
    <div class="love-msg-card">
      <h3 id="loveMsgTitle">Title</h3>
      <p id="loveMsgText">Text</p>
      <button id="loveMsgBtn" type="button">OK</button>
    </div>
  </div>

  <!-- 2) MUSIC CHOICE -->
  <div id="musicChoice" class="music-choice">
    <div class="music-card">
      <h3>Mau pake backsound ta? üéπ</h3>
      <p>Biar ga sunyi sunyi banget ü•π</p>
      <div class="mc-actions">
        <button id="musicYes" class="mc-btn mc-yes" type="button">Yes, please üíñ</button>
        <button id="musicNo" class="mc-btn mc-no" type="button">No, it‚Äôs okay</button>
      </div>
    </div>
  </div>

  <!-- BACKGROUND MUSIC -->
  <audio
    id="bgMusic"
    src="https://raw.githubusercontent.com/lord42m/srks/785d89cf3794216f09347cd2ae96d35b80256fe7/KTR.mp3"
    loop
    preload="auto"
  ></audio>

  <script>
    const quotes = [
      "Udah Habis >:("
    ];
    const QUOTE_STORAGE_KEY = 'for_s_last_quote';

    const popupBackdrop = document.getElementById('popupBackdrop');
    const popupTitle = document.getElementById('popupTitle');
    const popupBody = document.getElementById('popupBody');
    const popupCloseBtn = document.getElementById('popupCloseBtn');

    function closePopup(){
      popupBackdrop.classList.remove('active');
      popupBackdrop.setAttribute('aria-hidden','true');
      popupBody.innerHTML = "";
    }
    function openPopup({title, html}){
      popupTitle.textContent = title;
      popupBody.innerHTML = html;
      popupBackdrop.classList.add('active');
      popupBackdrop.setAttribute('aria-hidden','false');
    }

    let currentQuoteIndex = 0;
    function saveQuoteIndex(i){try{localStorage.setItem(QUOTE_STORAGE_KEY,String(i))}catch(e){}}
    function loadQuoteIndex(){try{const v=localStorage.getItem(QUOTE_STORAGE_KEY);if(v===null)return null;const n=Number(v);if(Number.isNaN(n))return null;if(n<0||n>=quotes.length)return null;return n;}catch(e){return null}}
    function renderQuoteContent(){
      const el=document.getElementById('quoteText');
      if(!el) return;
      el.textContent = quotes[currentQuoteIndex];
    }
    function openQuotesPopup(){
      const saved = loadQuoteIndex();
      currentQuoteIndex = saved !== null ? saved : Math.floor(Math.random()*quotes.length);
      const html = `
        <div class="popup-text" id="quoteText" style="padding:8px 4px 0 4px;"></div>
        <div class="popup-sub">Loveeee U ‚ù§Ô∏è.</div>
        <div class="popup-actions">
          <button type="button" class="popup-btn" data-action="prev">‚Üê Prev</button>
          <button type="button" class="popup-btn copy" data-action="copy">Copy üíå</button>
          <button type="button" class="popup-btn" data-action="next">Next ‚Üí</button>
        </div>
      `;
      openPopup({title:"Love u üí¨", html});
      renderQuoteContent();
      saveQuoteIndex(currentQuoteIndex);
      playSoftChime();
    }
    function goToNextQuote(){currentQuoteIndex=(currentQuoteIndex+1)%quotes.length;renderQuoteContent();saveQuoteIndex(currentQuoteIndex);}
    function goToPrevQuote(){currentQuoteIndex=(currentQuoteIndex-1+quotes.length)%quotes.length;renderQuoteContent();saveQuoteIndex(currentQuoteIndex);}
    async function copyCurrentQuote(){
      const q=quotes[currentQuoteIndex];
      try{
        await navigator.clipboard.writeText(q);
        const btn=popupBody.querySelector('[data-action="copy"]');
        if(btn){
          const old=btn.textContent;
          btn.textContent="Copied ‚úÖ";
          setTimeout(()=>btn.textContent=old,1500);
        }
      }catch(e){
        alert("Gagal copy, tapi kamu tetep cantik üòå");
      }
    }

    function showLetter(){
      const html = `
        <div class="popup-text" style="padding:4px 2px 0 2px;">
          Hi sayangku ‚ù§Ô∏è<br><br>
          Just in case hari ini kamu lagi ngerasa capek atau kepikiran banyak hal,
          aku mau kamu inget satu hal: kamu itu hal baik yang Tuhan titipin ke aku.
          Kamu lembut, perhatian, dan kamu selalu nyoba ngerti aku bahkan pas aku sendiri nggak ngerti diriku.
          <br><br>
          Aku bangga banget sama kamu. Sama semua hal yang kamu kejar, sama semua hal yang kamu tahan,
          sama caramu milih buat tetap stay di hubungan ini meski jarak dan waktu kadang nggak ramah.
          <br><br>
          Jadi kalo suatu hari kamu ragu, buka ini lagi ya.
          Aku nggak ke mana-mana. I‚Äôm choosing you, over and over. üíå
        </div>
        <div class="popup-sub">- your M ü§ç</div>
      `;
      openPopup({title:"A little letter ‚úâÔ∏è", html});
    }

    function openSpotify(){
      window.location='spotify:playlist:3BBdBzOrmW88fxN50IDeWu';
      setTimeout(()=>{window.open('https://open.spotify.com/playlist/3BBdBzOrmW88fxN50IDeWu','_blank')},500);
    }

    let audioCtx = null;
    function getAudioCtx(){
      if(!audioCtx){
        audioCtx = new (window.AudioContext || window.webkitAudioContext)();
      }
      return audioCtx;
    }
    function playSoftChime(){
      try{
        const ctx = getAudioCtx();
        const now = ctx.currentTime;
        const osc = ctx.createOscillator();
        const gain = ctx.createGain();
        osc.type="sine";
        osc.frequency.setValueAtTime(660,now);
        gain.gain.setValueAtTime(0.0001,now);
        gain.gain.exponentialRampToValueAtTime(0.3,now+0.03);
        gain.gain.exponentialRampToValueAtTime(0.0001,now+0.6);
        osc.connect(gain).connect(ctx.destination);
        osc.start(now);
        osc.stop(now+0.6);
      }catch(e){}
    }

    // === bg music (Kiss the Rain) ===
    const bgMusic = document.getElementById('bgMusic');
    async function startBackgroundMusic(){
      if(!bgMusic) return;
      try{
        await bgMusic.play();
      }catch(e){
        // needs user tap
      }
    }
    function stopBackgroundMusic(){
      if(!bgMusic) return;
      bgMusic.pause();
      bgMusic.currentTime = 0;
    }

    // love gate logic
    const loveGate = document.getElementById('loveGate');
    const loveGateCard = document.getElementById('loveGateCard');
    const loveYes = document.getElementById('loveYes');
    const loveNo = document.getElementById('loveNo');

    // small popup
    const loveMsgOverlay = document.getElementById('loveMsgOverlay');
    const loveMsgTitle = document.getElementById('loveMsgTitle');
    const loveMsgText = document.getElementById('loveMsgText');
    const loveMsgBtn = document.getElementById('loveMsgBtn');
    let loveMsgMode = null; // "angry" or "love"

    function showLoveMsg({mode,title,text,btnText}){
      loveMsgMode = mode;
      loveMsgTitle.textContent = title;
      loveMsgText.textContent = text;
      loveMsgBtn.textContent = btnText || "OK";
      loveMsgOverlay.classList.add('show');
    }
    function hideLoveMsg(){
      loveMsgOverlay.classList.remove('show');
    }

    function showMusicChoice(){
      const mc = document.getElementById('musicChoice');
      mc.classList.add('active');
    }

    let loveNoCount = 0;

    loveYes.addEventListener('click', () => {
      // show "nah gitu dong"
      showLoveMsg({
        mode: "love",
        title: "nah gitu dong ü•∞",
        text: "love u too üíó",
        btnText: "ü•∫üíï"
      });
    });

    loveNo.addEventListener('click', () => {
      loveNoCount += 1;

      // make it hop but near center
      const vw = window.innerWidth;
      const vh = window.innerHeight;
      const cardW = 340;
      const cardH = 240;
      const maxX = Math.min(120, (vw - cardW)/2);
      const maxY = Math.min(90, (vh - cardH)/2);
      const randX = (Math.random() * 2 - 1) * maxX;
      const randY = (Math.random() * 2 - 1) * maxY;
      loveGateCard.style.transform = `translate(${randX}px, ${randY}px)`;

      // every 5 nos, scold
      if(loveNoCount >= 5){
        loveNoCount = 0;
        showLoveMsg({
          mode: "angry",
          title: "aku marah nih üò§",
          text: "kok pilih no terus siiihh üò≠ harus pilih yes!",
          btnText: "iya maaf ü•∫"
        });
      }
    });

    loveMsgBtn.addEventListener('click', () => {
      // if angry ‚Üí just close, keep love gate open
      if(loveMsgMode === "angry"){
        hideLoveMsg();
        return;
      }
      // if love ‚Üí now we can enter
      if(loveMsgMode === "love"){
        hideLoveMsg();
        loveGate.classList.add('hide');
        document.body.classList.remove('locked');
        setTimeout(showMusicChoice, 240);
      }
    });

    // music choice
    const musicChoice = document.getElementById('musicChoice');
    const musicYes = document.getElementById('musicYes');
    const musicNo = document.getElementById('musicNo');

    musicYes.addEventListener('click', () => {
      startBackgroundMusic();
      musicChoice.classList.remove('active');
    });
    musicNo.addEventListener('click', () => {
      stopBackgroundMusic();
      musicChoice.classList.remove('active');
    });

    // hearts canvas
    const canvas = document.getElementById("heartsCanvas");
    const ctx2 = canvas.getContext("2d");
    let hearts=[];
    const HEART_COUNT=28;
    function resizeCanvas(){
      canvas.width = window.innerWidth;
      canvas.height = window.innerHeight;
      hearts = Array.from({length:HEART_COUNT}, () => new Heart());
    }
    class Heart{
      constructor(){this.reset();}
      reset(){
        this.x = Math.random()*canvas.width;
        this.y = canvas.height + 40;
        this.size = Math.random()*14 + 10;
        this.speedY = Math.random()*0.7 + 0.4;
        this.driftX = (Math.random()-0.5)*0.5;
        this.alpha = Math.random()*0.4 + 0.4;
        this.lifeFade = Math.random()*0.0009 + 0.0009;
        const palette = [
          {r:255,g:77,b:109},
          {r:255,g:140,b:170},
          {r:255,g:184,b:200},
          {r:226,g:134,b:255},
        ];
        this.color = palette[Math.floor(Math.random()*palette.length)];
      }
      step(){
        this.y -= this.speedY;
        this.x += this.driftX;
        this.alpha -= this.lifeFade;
        if(this.alpha <= 0 || this.y < -40){
          this.reset();
          this.y = canvas.height + 40;
        }
      }
      draw(ctx){
        const drawHeartShape = (scale=1)=>{
          const s = this.size*scale;
          ctx.beginPath();
          ctx.moveTo(0, -0.3*s);
          ctx.bezierCurveTo(0, -0.6*s, -0.6*s, -0.6*s, -0.6*s, -0.15*s);
          ctx.bezierCurveTo(-0.6*s, 0.1*s, -0.3*s, 0.35*s, 0, 0.55*s);
          ctx.bezierCurveTo(0.3*s, 0.35*s, 0.6*s, 0.1*s, 0.6*s, -0.15*s);
          ctx.bezierCurveTo(0.6*s, -0.6*s, 0, -0.6*s, 0, -0.3*s);
          ctx.closePath();
        };
        ctx.save();
        ctx.translate(this.x, this.y);

        ctx.save();
        ctx.globalAlpha = this.alpha * 0.5;
        ctx.shadowColor = `rgba(${this.color.r},${this.color.g},${this.color.b},0.8)`;
        ctx.shadowBlur = this.size * 1.5;
        ctx.fillStyle = `rgba(${this.color.r},${this.color.g},${this.color.b},0.25)`;
        drawHeartShape(1.4);
        ctx.fill();
        ctx.restore();

        ctx.save();
        ctx.globalAlpha = this.alpha;
        ctx.fillStyle = `rgba(${this.color.r},${this.color.g},${this.color.b},1)`;
        ctx.strokeStyle = `rgba(255,255,255,0.6)`;
        ctx.lineWidth = 0.6;
        drawHeartShape(1.0);
        ctx.fill();
        ctx.stroke();
        ctx.restore();

        ctx.restore();
      }
    }
    function animate(){
      ctx2.clearRect(0,0,canvas.width,canvas.height);
      hearts.forEach(h=>{h.step();h.draw(ctx2);});
      requestAnimationFrame(animate);
    }

    // SW
    (function registerSW(){
      if('serviceWorker' in navigator){
        const swCode = `
          const CACHE='for-s-v1';
          self.addEventListener('install',e=>{
            e.waitUntil(caches.open(CACHE).then(c=>c.addAll(['./'])).catch(()=>{}));
            self.skipWaiting();
          });
          self.addEventListener('activate',e=>{
            e.waitUntil(self.clients.claim());
          });
          self.addEventListener('fetch',e=>{
            e.respondWith(fetch(e.request).catch(()=>caches.match(e.request)));
          });
        `;
        const blob = new Blob([swCode],{type:'text/javascript'});
        const url = URL.createObjectURL(blob);
        navigator.serviceWorker.register(url).catch(()=>{});
      }
    })();

    document.addEventListener('DOMContentLoaded', () => {
      const btnPlaylist = document.getElementById('btnPlaylist');
      const btnLove = document.getElementById('btnLove');
      const btnLetter = document.getElementById('btnLetter');

      btnPlaylist.addEventListener('click', () => {
        openSpotify();
      });
      btnLove.addEventListener('click', () => {
        openQuotesPopup();
      });
      btnLetter.addEventListener('click', () => {
        showLetter();
      });

      popupCloseBtn.addEventListener('click', closePopup);
      popupBackdrop.addEventListener('click',(e)=>{ if(e.target===popupBackdrop) closePopup(); });
      popupBody.addEventListener('click',(e)=>{
        const btn=e.target.closest('[data-action]');
        if(!btn) return;
        const act=btn.getAttribute('data-action');
        if(act==='next') goToNextQuote();
        else if(act==='prev') goToPrevQuote();
        else if(act==='copy') copyCurrentQuote();
      });
      document.addEventListener('keydown',(e)=>{
        if(e.key==='Escape' && popupBackdrop.classList.contains('active')){
          closePopup();
        }
      });

      resizeCanvas();
      animate();
    });
    window.addEventListener('resize', resizeCanvas);
  </script>
</body>
</html>

